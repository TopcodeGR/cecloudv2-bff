<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">


    <changeSet id="install_pg_crypto_extension" author="topal">
        <sql>
            create extension pgcrypto;
        </sql>
    </changeSet>
    <changeSet id="create_authorized_client_tables" author="topal">
        <sql>
            CREATE TABLE oauth2_authorized_client (
                  client_registration_id varchar(100) NOT NULL,
                  principal_name varchar(200) NOT NULL,
                  access_token_type varchar(100) NOT NULL,
                  access_token_value bytea NOT NULL,
                  access_token_issued_at timestamp NOT NULL,
                  access_token_expires_at timestamp NOT NULL,
                  access_token_scopes varchar(1000) DEFAULT NULL,
                  refresh_token_value bytea DEFAULT NULL,
                  refresh_token_issued_at timestamp DEFAULT NULL,
                  created_at timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
                  PRIMARY KEY (client_registration_id, principal_name)
            );
        </sql>

    </changeSet>



    <changeSet id="create_session_tables" author="topal">
        <sql>
            CREATE TABLE CECLOUD_SESSION (
                id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                session_id VARCHAR(100)  NOT NULL ,
                access_token VARCHAR(2000) NOT NULL ,
                refresh_token VARCHAR(2000) NOT NULL,
                id_token VARCHAR(2000) NOT NULL,
                user_id VARCHAR(100) NOT NULL,
                keycloak_session VARCHAR(100) NOT NULL
            );
        </sql>
    </changeSet>

</databaseChangeLog>

